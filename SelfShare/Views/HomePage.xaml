<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:SelfShare.Models"
             x:Class="SelfShare.Views.HomePage"
             Title="Home"
             Shell.NavBarIsVisible="False"
             BackgroundColor="#F5F5F5">

    <Grid RowDefinitions="Auto, *">

        <VerticalStackLayout Grid.Row="0" 
                             BackgroundColor="#2D9CDB"
                             Padding="20,15,20,20" 
                             Spacing="10">

            <Label Text="Home" 
                   TextColor="White" 
                   FontSize="28" 
                   FontAttributes="Bold" />

            <Frame CornerRadius="10" 
                   Padding="10,0" 
                   HeightRequest="45" 
                   BackgroundColor="White" 
                   HasShadow="False"
                   BorderColor="Transparent">

                <Entry Placeholder="Search book or writer..." 
                       PlaceholderColor="#999"
                       TextColor="Black"
                       VerticalOptions="Center" 
                       FontSize="14"
                       TextChanged="OnSearchBarTextChanged"/>
            </Frame>
        </VerticalStackLayout>

        <CollectionView Grid.Row="1" x:Name="BooksCollection" Margin="10">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Book">
                    <Frame Margin="0,5" 
                           Padding="10" 
                           CornerRadius="10" 
                           HasShadow="True" 
                           BackgroundColor="White" 
                           BorderColor="Transparent">

                        <Grid ColumnDefinitions="80, *" ColumnSpacing="15">

                            <Frame Grid.Column="0" 
                                   Padding="0" 
                                   CornerRadius="8" 
                                   IsClippedToBounds="True" 
                                   HeightRequest="100" 
                                   WidthRequest="80" 
                                   BorderColor="#E0E0E0"
                                   BackgroundColor="#F0F0F0">
                                <Grid>
                                    <Label Text="No Image"
                                           TextColor="#999999"
                                           FontSize="11"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"
                                           HorizontalTextAlignment="Center"/>

                                    <Image Source="{Binding ImageUrl}" 
                                           Aspect="AspectFill" 
                                           HeightRequest="100" 
                                           WidthRequest="80" />
                                </Grid>
                            </Frame>

                            <VerticalStackLayout Grid.Column="1" Spacing="5" VerticalOptions="Center">
                                <Label Text="{Binding Title}" 
                                       FontSize="16" 
                                       FontAttributes="Bold" 
                                       TextColor="#333333" 
                                       LineBreakMode="TailTruncation"/>

                                <Label Text="{Binding Author}" 
                                       FontSize="13" 
                                       TextColor="#666666" />

                                <HorizontalStackLayout Spacing="10">
                                    <Label Text="{Binding Condition}" 
                                           FontSize="11" 
                                           TextColor="#4A90E2" 
                                           BackgroundColor="#E3F2FD" 
                                           Padding="6,2" />

                                    <Label Text="{Binding OwnerName}" 
                                           FontSize="11" 
                                           TextColor="#999" 
                                           VerticalOptions="Center"/>
                                </HorizontalStackLayout>

                                <Button Text="Send to request"
                                        BackgroundColor="#009688"
                                        TextColor="White"
                                        FontSize="12"
                                        HeightRequest="35"
                                        Padding="10,0"
                                        CornerRadius="5"
                                        HorizontalOptions="Start"
                                        Margin="0,5,0,0"
                                        Clicked="OnSendRequestClicked" 
                                        CommandParameter="{Binding .}" />
                            </VerticalStackLayout>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>